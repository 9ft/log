<!doctype html><html lang=zh-cn><head><title>我是如何在天津大学上网的 ::
未命名</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="前言 刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的流量免费, 而且上网限制不多. IPv4 流量收费, 开始的计费方式因为一直没用忘记了, 在最近一次调价(降价)后的计费的策略是每月 5G 免费流量, 可以叠加流量"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/tjunet/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="我是如何在天津大学上网的"><meta name=twitter:description content="前言 刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的流量免费, 而且上网限制不多. IPv4 流量收费, 开始的计费方式因为一直没用忘记了, 在最近一次调价(降价)后的计费的策略是每月 5G 免费流量, 可以叠加流量"><meta property="og:title" content="我是如何在天津大学上网的"><meta property="og:description" content="前言 刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的流量免费, 而且上网限制不多. IPv4 流量收费, 开始的计费方式因为一直没用忘记了, 在最近一次调价(降价)后的计费的策略是每月 5G 免费流量, 可以叠加流量"><meta property="og:type" content="article"><meta property="og:url" content="/posts/tjunet/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-08-26T18:46:32+08:00"><meta property="article:modified_time" content="2016-08-26T18:46:32+08:00"><meta property="og:site_name" content="未命名"></head><body><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>未命名</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/archive/>Archive</a></li><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/archive/>Archive</a></li><li><a href=/about>About</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>我是如何在天津大学上网的</h1><div class=post-meta><span class=post-date>2016-08-26</span></div><div class=post-content><h2>Table of Contents</h2><aside class=table-of-contents><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#需求>需求</a></li><li><a href=#开工>开工</a><ul><li><a href=#服务器>服务器</a></li><li><a href=#本地配置>本地配置</a></li></ul></li><li><a href=#目前的解决方案>目前的解决方案</a></li></ul></nav></aside><h2 id=前言>前言</h2><p>刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的流量免费, 而且上网限制不多. IPv4 流量收费, 开始的计费方式因为一直没用忘记了, 在最近一次调价(降价)后的计费的策略是每月 5G 免费流量, 可以叠加流量包 ¥2/1GB, 感觉挺贵的, 而且计量的方式很不方便.</p><p><img src=tjunet_price.png alt="TJUNET Price" title="TJUNET Price"></p><p>每个月光更新软件估计就有 5G 了吧. 有免费的 IPv6 为什么还要付费买流量. 这篇文章记录一下我来天大后的免费上网策略, 应该也适合其他教育网用户.</p><h2 id=需求>需求</h2><p>需求的程度依次递减</p><ol><li>免费上网</li><li>科学上网</li><li>全平台</li><li>不依赖校内服务器</li></ol><p>第一, 免费上网就是就是折腾这些的力量来源, 刚需. 第二, 不能科学上网的网络对我来说就是没网. 第三, 目前在用 iOS / Android / Win / macOS, 全平台是必须的. 第四, 下面的方法有的会依赖一台学校里的服务器, 对于没有条件的当然不是一个好策略.</p><h2 id=开工>开工</h2><h3 id=服务器>服务器</h3><p>基本方法都是将所有流量转换成 IPv6 流量, 所以必须依靠一台同时具有 IPv6 和 IPv4 访问权限的主机. 免费的服务可以使用 Google App Engine, 付费的就是各种 VPS 主机了. 阿里云没 IPv6 而且带宽低, 否掉. 国内主机都可以排除掉, 因为选择了外国主机, 就同时兼备免费上网和科学上网了.</p><h4 id=免费的-goagent>免费的 GoAgent</h4><p>以前使用过好几年 GoAgent 了, 免费稳定, 怀念至今, 但它不是死掉了么? 那是因为在 IPv4 环境下可用 IP 都被 BAN 掉了, IPv6 环境下只要稍作调整就可以继续使用, 使用 GoAgent 刚好也能解决 Win / macOS 多平台的问题.</p><p>GoAgent 中修改本地配置 <code>proxy.ini</code>. <code>gae</code> 中开启 IPv6: <code>ipv6 = 1</code>, 找到 Google 的 v6 地址在 <code>iplist</code> 中的 <code>google_ipv6</code> 填入. 就可以享受快速稳定的免流量网络了.</p><p><code>proxy.ini</code> 中:</p><pre><code class=language-conf data-lang=conf>[gae]
ipv6 = 1
[iplist]
google_ipv6 = IPv6 地址
</code></pre><p>对 iOS / Android 移动平台, iOS 好像没 GoAgent 软件, Android 下有软件, 但我的 Android 还不能获取 v6 地址, 暂时没试. 只能曲线救国, 在校内一台电脑上运行 GoAgent, 并通过 Privoxy 开启 HTTP 代理服务器来分发网络, Privoxy 怎样配置, 后面会讲到.</p><h4 id=shadowsocks>Shadowsocks</h4><p>Shadowsocks 的混淆能力比较强, 使用的很普及, 用 IPv6 网络上 Shadowsocks 服务器就中转掉所有流量也是个好办法. 搭建 Shadowsocks 服务器可以参见我写的 [SS搭建]({% post_url 2015-10-12-build-ss %}). 需要注意配置文件 <code>shadowsocks.json</code> 中 <code>server</code> 的值应该为 <code>::</code>, 这样才可以用服务器的 IPv6 地址连接 SS, 网上查的很多配置都没注意 IPv6 环境.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;server&#34;</span>: <span style=color:#e6db74>&#34;::&#34;</span>,
    <span style=color:#f92672>&#34;local_address&#34;</span>: <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>,
    <span style=color:#f92672>&#34;local_port&#34;</span>:<span style=color:#ae81ff>1080</span>,
    <span style=color:#f92672>&#34;port_password&#34;</span>:{
         <span style=color:#f92672>&#34;10001&#34;</span>: <span style=color:#e6db74>&#34;pass1&#34;</span>,
         <span style=color:#f92672>&#34;20001&#34;</span>: <span style=color:#e6db74>&#34;pass2&#34;</span>
    },
    <span style=color:#f92672>&#34;timeout&#34;</span>:<span style=color:#ae81ff>300</span>,
    <span style=color:#f92672>&#34;method&#34;</span>: <span style=color:#e6db74>&#34;chacha20&#34;</span>,
    <span style=color:#f92672>&#34;fast_open&#34;</span>: <span style=color:#66d9ef>false</span>
}
</code></pre></div><h4 id=vpn>VPN</h4><p>使用 IPv6 地址连接 VPN 服务器也是一个好办法, 不过我目前搭建的 VPN 只能在 Win 下使用. iOS / macOS 提示出错, 而使用 v4 地址却能正确连接, 原因不明.</p><p>VPN 方法全局流量都走服务器, 所以优缺参半:</p><p>优点:</p><ul><li>Win 平台下可以使用 Win10 商店和应用(Metro). 如果使用 GoAgent 或 SS 还要搭配 Proxifier, Fiddler 软件.</li><li>Win 平台下可以不用配置代理直接使用 npm gem git 等命令.</li></ul><p>缺点:</p><ul><li>缺点也很致命, 没办法使用教育网上的一些 PT 站.</li><li>与其他设备不在一个局域网上.</li></ul><p>VPN 对我来说还挺常用的, 在下载机以外的设备上使用很省心.</p><h3 id=本地配置>本地配置</h3><h4 id=win-平台使用-proxifier-将代理设置为全局>Win 平台使用 Proxifier 将代理设置为全局</h4><p><strong>配置 Proxy Servers</strong></p><p><img src=Win_Proxifier_Proxy_Servers.png alt="Proxy Servers" title="Proxy Servers"></p><p><strong>配置 Proxification Rules</strong></p><p>校内的和 IPv6 连接直连, 其余走代理.</p><p><img src=Win_Proxification_Rules.png alt="Proxification Rules" title="Proxification Rules"></p><p>正常使用应用商店和 Win10 App 还要使用 Fiddler 软件, 效果并不好. 如果不使用 Win10 App, 这种方法在 Win 下很完美了.</p><h4 id=使用-privoxy-搭建代理服务器>使用 Privoxy 搭建代理服务器</h4><p>如果使用 GoAgent 和 Shadowsocks, 为了方便 iOS / Android 平台的使用, 需要在校内搭建一台代理服务器, 这里搭建的是一个 HTTP 代理服务器, 任何设备都原生支持这种代理方式.</p><p>Win 下的 SS 自带了局域网分发网络的功能, 这里使用的是 <code>privoxy</code>, 版本 3.0.23. <code>config.txt</code> 更改如下:</p><pre><code class=language-conf data-lang=conf>listen-address 0.0.0.0:1234      # 改为自己想要的端口号, 因为服务器不是静态IP, IP 就设置成 0.0.0.0:1234 了, [::]:1234 应该也可以.
forward        / .               # 转发所有通信（/）到所有目标（.)
forward-socks5 / 127.0.0.1:1080  # 转发所有通信到 SS 代理服务器上.
</code></pre><p>三行搞定, 端口 <code>1234</code> 需要在防火墙中设置为允许.</p><p>完成这些步骤, 就可以把 IP 和端口告诉自己的好朋友和妹子们, 通过这个 HTTP 代理就能免费上网了!</p><h4 id=ios--macos-平台使用-surge>iOS / macOS 平台使用 Surge</h4><h5 id=全局使用代理>全局使用代理</h5><p>iOS 10 支持 IPv6 后, iOS 不需要依赖校内服务器就可以上网了. 需要搭配使用一个 &ldquo;网络调试&rdquo; 神器 Surge. 作者又发布了 Surge for Mac, 配置通用, 所以 iOS / macOS 平台下使用 Surge 的方法也通用.</p><p>其他高校的 v6 站直连, <code>*6.edu.cn</code> 填到 <code>skip-proxy</code> 中代理处理. 其他规则也很好写.</p><p><strong>配置规则</strong></p><pre><code class=language-conf data-lang=conf>[Rule]
IP-CIDR,202.113.0.0/16,DIRECT     # 校内 IP
DOMAIN-SUFFIX,twt.edu.cn,DIRECT   # 直接访问校内网站
DOMAIN-SUFFIX,tju.edu.cn,DIRECT   # 直接访问校内网站
FINAL,Proxy                       # 所有请求走代理服务器
</code></pre><p>macOS 命令行使用代理可以用 ProxyChains, 也可以用傻瓜模式的 Proxifier. 配置和 Windows 平台下的 Proxifier 一样.</p><p><strong>配置 Proxy Servers</strong></p><p><img src=macOS_Proxifier_Proxy_Servers.png alt="Proxy Servers" title="Proxy Servers"></p><p><strong>配置 Proxification Rules</strong></p><p>校内的和 IPv6 连接直连, 其余都走代理.</p><p><img src=macOS_Proxification_Rules.png alt="Proxification Rules" title="Proxification Rules"></p><h4 id=ios--macos-平台使用-surge-进阶>iOS / macOS 平台使用 Surge 进阶</h4><p>既然使用了 Surge, 一定好好折腾一下, 不然浪费了这么强大的工具.</p><p>配置的目标是可以自动切换上网方式, 只要打开 Surge, 任何网络环境都可以上网:</p><ul><li>校园网下自动使用 IPv6 免流量上网, 科学上网.</li><li>移动数据网络下使用 IPv4, PAC 自动切换, 国内直连, 科学上网.</li><li>一般 / 特定网络下(比如咖啡馆 WiFi)使用 IPv4, PAC 自动切换, 国内直连, 科学上网.</li></ul><p>这里以两台 SS 服务器为例.</p><p><strong>配置服务器</strong></p><p>添加两台服务器的 v4 和 v6 的访问方式:</p><pre><code class=language-conf data-lang=conf>[Proxy]
server1.ss.v4 = custom,v4_IP,10001,chacha20,pass1,http://surge.pm/ss.module
server1.ss.v6 = custom,v6_IP,10001,chacha20,pass1,http://surge.pm/ss.module
server2.ss.v4 = custom,v4_IP,10001,chacha20,pass1,http://surge.pm/ss.module
server2.ss.v6 = custom,v6_IP,10001,chacha20,pass1,http://surge.pm/ss.module
</code></pre><p><strong>配置规则</strong></p><pre><code class=language-conf data-lang=conf>[Rule]
DOMAIN-SUFFIX,t66y.com,Proxy         # 一直走代理的连接
DOMAIN-SUFFIX,ad.sina.com.cn,REJECT  # 拒绝的连接
GEOIP,CN,GEO CN                      # 国内连接
FINAL,Proxy                          # 其余所有连接
</code></pre><p>正常访问的外国网站也会走代理, 就当加速了&mldr;</p><p><strong>配置代理服务器组</strong></p><p>ss.url-test.v4 为 v4 环境下挑选一个最快服务器, ss.url-test.v6 为 v6 环境下挑选一个最快服务器.</p><p>Proxy 代理方式设置为根据 ssid 切换, 默认为 v4 环境, 移动数据网络下 cellular 当然也走 v4, 校园网 tjuwlan 要走 v6 服务器, 还可以设置其他一些特定的 ssid.</p><p>GEO CN 代理方式也根据 ssid 切换, 默认 v4 环境直连, v6 环境下走 v6 代理服务器.</p><pre><code class=language-conf data-lang=conf>[Proxy Group]
ss.url-test.v4 = url-test, server1.ss.v4, server2.ss.v4, url = http://www.google.com/generate_204
ss.url-test.v6 = url-test, server1.ss.v6, server2.ss.v4, url = http://www.google.com/generate_204
Proxy = ssid, default = ss.url-test.v4, cellular = ss.url-test.v4, &quot;tjuwlan&quot; = ss.url-test.v6, &quot;实验室宽带 AP&quot; = ss.url-test.v4
GEO CN = ssid, default = DIRECT, cellular = DIRECT, &quot;tjuwlan&quot; = ss.url-test.v6, &quot;实验室宽带 AP&quot; = DIRECT
</code></pre><p>Surge 这点最好, iOS / macOS 平台配置完就可以应付各种网络环境.</p><p>iOS 支持 IPv6 后, 搭配 Surge 可以独立免费上网. 我的 Android 仍然只有本地链路地址, 暂时无解, 只能依靠一台校内服务器.</p><h2 id=目前的解决方案>目前的解决方案</h2><ul><li>实验室台式机: SS, 负责 PT 做种, 通过 Privoxy 分发网络.</li><li>macOS: Surge.</li><li>iOS: Surge.</li><li>Android: 通过 Privoxy 分发的网络.</li><li>Win 笔记本: VPN, 免折腾.</li></ul><p>哈哈, 至今从没买过学校的流量包!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>更多</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/nginx-https/><span class=button__icon>←</span>
<span class=button__text>使用 Let’s Encrypt 为网站增加 HTTPS 访问方式</span></a></span>
<span class="button next"><a href=/posts/music-player/><span class=button__text>音乐播放器</span>
<span class=button__icon>→</span></a></span></div></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//mindytech.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>未命名</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2021 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-46567212-1','auto'),ga('send','pageview'))</script></body></html>
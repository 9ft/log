<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>我是如何在天津大学上网的 - log</title><meta name=renderer content=webkit><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta name=theme-color content=#f8f5ec><meta name=msapplication-navbutton-color content=#f8f5ec><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f8f5ec><meta name=author content="Mindy Cong"><meta name=description content="前言 刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的"><meta name=keywords content=Tech,Code,Life><meta name=generator content="Hugo 0.58.3 with theme even"><link rel=canonical href=http://mindy.tk/post/tjunet/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/dist/even.c2a46f00.min.css rel=stylesheet><meta property=og:title content=我是如何在天津大学上网的><meta property=og:description content="前言 刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的"><meta property=og:type content=article><meta property=og:url content=http://mindy.tk/post/tjunet/><meta property=article:published_time content=2016-08-26T18:46:32+08:00><meta property=article:modified_time content=2019-03-25T23:52:57+08:00><meta itemprop=name content=我是如何在天津大学上网的><meta itemprop=description content="前言 刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的"><meta itemprop=datePublished content=2016-08-26T18:46:32&#43;08:00><meta itemprop=dateModified content=2019-03-25T23:52:57&#43;08:00><meta itemprop=wordCount content=2292><meta itemprop=keywords content><meta name=twitter:card content=summary><meta name=twitter:title content=我是如何在天津大学上网的><meta name=twitter:description content="前言 刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>log</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>log</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>我是如何在天津大学上网的</h1><div class=post-meta><span class=post-time>2016-08-26</span>
<span class=more-meta>2292 words</span>
<span class=more-meta>5 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#需求>需求</a></li><li><a href=#开工>开工</a><ul><li><a href=#服务器>服务器</a><ul><li><a href=#免费的-goagent>免费的 GoAgent</a></li><li><a href=#shadowsocks>Shadowsocks</a></li><li><a href=#vpn>VPN</a></li></ul></li><li><a href=#本地配置>本地配置</a><ul><li><a href=#win-平台使用-proxifier-将代理设置为全局>Win 平台使用 Proxifier 将代理设置为全局</a></li><li><a href=#使用-privoxy-搭建代理服务器>使用 Privoxy 搭建代理服务器</a></li><li><a href=#ios-macos-平台使用-surge>iOS / macOS 平台使用 Surge</a><ul><li><a href=#全局使用代理>全局使用代理</a></li></ul></li><li><a href=#ios-macos-平台使用-surge-进阶>iOS / macOS 平台使用 Surge 进阶</a></li></ul></li></ul></li><li><a href=#目前的解决方案>目前的解决方案</a></li></ul></nav></div></div><div class=post-content><h1 id=前言>前言</h1><p>刚刚来到天大的时候, 第一次接触有 IPv6 的网络, 以前就听说过教育网但没接触过. IPv6 是教育网提供的, 而且很多高校都接入了教育网. IPv6 最吸引人的是它的流量免费, 而且上网限制不多. IPv4 流量收费, 开始的计费方式因为一直没用忘记了, 在最近一次调价(降价)后的计费的策略是每月 5G 免费流量, 可以叠加流量包 ¥2/1GB, 感觉挺贵的, 而且计量的方式很不方便.</p><p><img src=/img/post/2016-08-26-tjunet/tjunet_price.png alt="TJUNET Price" title="TJUNET Price"></p><p>每个月光更新软件估计就有 5G 了吧. 有免费的 IPv6 为什么还要付费买流量. 这篇文章记录一下我来天大后的免费上网策略, 应该也适合其他教育网用户.</p><h1 id=需求>需求</h1><p>需求的程度依次递减</p><ol><li>免费上网</li><li>科学上网</li><li>全平台</li><li>不依赖校内服务器</li></ol><p>第一, 免费上网就是就是折腾这些的力量来源, 刚需. 第二, 不能科学上网的网络对我来说就是没网. 第三, 目前在用 iOS / Android / Win / macOS, 全平台是必须的. 第四, 下面的方法有的会依赖一台学校里的服务器, 对于没有条件的当然不是一个好策略.</p><h1 id=开工>开工</h1><h2 id=服务器>服务器</h2><p>基本方法都是将所有流量转换成 IPv6 流量, 所以必须依靠一台同时具有 IPv6 和 IPv4 访问权限的主机. 免费的服务可以使用 Google App Engine, 付费的就是各种 VPS 主机了. 阿里云没 IPv6 而且带宽低, 否掉. 国内主机都可以排除掉, 因为选择了外国主机, 就同时兼备免费上网和科学上网了.</p><h3 id=免费的-goagent>免费的 GoAgent</h3><p>以前使用过好几年 GoAgent 了, 免费稳定, 怀念至今, 但它不是死掉了么? 那是因为在 IPv4 环境下可用 IP 都被 BAN 掉了, IPv6 环境下只要稍作调整就可以继续使用, 使用 GoAgent 刚好也能解决 Win / macOS 多平台的问题.</p><p>GoAgent 中修改本地配置 <code>proxy.ini</code>. <code>gae</code> 中开启 IPv6: <code>ipv6 = 1</code>, 找到 Google 的 v6 地址在 <code>iplist</code> 中的 <code>google_ipv6</code> 填入. 就可以享受快速稳定的免流量网络了.</p><p><code>proxy.ini</code> 中:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf>[gae]
ipv6 = 1
[iplist]
google_ipv6 = IPv6 地址</code></pre></td></tr></table></div></div><p>对 iOS / Android 移动平台, iOS 好像没 GoAgent 软件, Android 下有软件, 但我的 Android 还不能获取 v6 地址, 暂时没试. 只能曲线救国, 在校内一台电脑上运行 GoAgent, 并通过 Privoxy 开启 HTTP 代理服务器来分发网络, Privoxy 怎样配置, 后面会讲到.</p><h3 id=shadowsocks>Shadowsocks</h3><p>Shadowsocks 的混淆能力比较强, 使用的很普及, 用 IPv6 网络上 Shadowsocks 服务器就中转掉所有流量也是个好办法. 搭建 Shadowsocks 服务器可以参见我写的 <a href="{% post_url 2015-10-12-build-ss %}">SS搭建</a>. 需要注意配置文件 <code>shadowsocks.json</code> 中 <code>server</code> 的值应该为 <code>::</code>, 这样才可以用服务器的 IPv6 地址连接 SS, 网上查的很多配置都没注意 IPv6 环境.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
    <span class=nt>&#34;server&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
    <span class=nt>&#34;local_address&#34;</span><span class=p>:</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span>
    <span class=nt>&#34;local_port&#34;</span><span class=p>:</span><span class=mi>1080</span><span class=p>,</span>
    <span class=nt>&#34;port_password&#34;</span><span class=p>:{</span>
         <span class=nt>&#34;10001&#34;</span><span class=p>:</span> <span class=s2>&#34;pass1&#34;</span><span class=p>,</span>
         <span class=nt>&#34;20001&#34;</span><span class=p>:</span> <span class=s2>&#34;pass2&#34;</span>
    <span class=p>},</span>
    <span class=nt>&#34;timeout&#34;</span><span class=p>:</span><span class=mi>300</span><span class=p>,</span>
    <span class=nt>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;chacha20&#34;</span><span class=p>,</span>
    <span class=nt>&#34;fast_open&#34;</span><span class=p>:</span> <span class=kc>false</span>
<span class=p>}</span></code></pre></td></tr></table></div></div><h3 id=vpn>VPN</h3><p>使用 IPv6 地址连接 VPN 服务器也是一个好办法, 不过我目前搭建的 VPN 只能在 Win 下使用. iOS / macOS 提示出错, 而使用 v4 地址却能正确连接, 原因不明.</p><p>VPN 方法全局流量都走服务器, 所以优缺参半:</p><p>优点:</p><ul><li>Win 平台下可以使用 Win10 商店和应用(Metro). 如果使用 GoAgent 或 SS 还要搭配 Proxifier, Fiddler 软件.</li><li>Win 平台下可以不用配置代理直接使用 npm gem git 等命令.</li></ul><p>缺点:</p><ul><li>缺点也很致命, 没办法使用教育网上的一些 PT 站.</li><li>与其他设备不在一个局域网上.</li></ul><p>VPN 对我来说还挺常用的, 在下载机以外的设备上使用很省心.</p><h2 id=本地配置>本地配置</h2><h3 id=win-平台使用-proxifier-将代理设置为全局>Win 平台使用 Proxifier 将代理设置为全局</h3><p><strong>配置 Proxy Servers</strong></p><p><img src=/img/post/2016-08-26-tjunet/Win_Proxifier_Proxy_Servers.png alt="Proxy Servers" title="Proxy Servers"></p><p><strong>配置 Proxification Rules</strong></p><p>校内的和 IPv6 连接直连, 其余走代理.</p><p><img src=/img/post/2016-08-26-tjunet/Win_Proxification_Rules.png alt="Proxification Rules" title="Proxification Rules"></p><p>正常使用应用商店和 Win10 App 还要使用 Fiddler 软件, 效果并不好. 如果不使用 Win10 App, 这种方法在 Win 下很完美了.</p><h3 id=使用-privoxy-搭建代理服务器>使用 Privoxy 搭建代理服务器</h3><p>如果使用 GoAgent 和 Shadowsocks, 为了方便 iOS / Android 平台的使用, 需要在校内搭建一台代理服务器, 这里搭建的是一个 HTTP 代理服务器, 任何设备都原生支持这种代理方式.</p><p>Win 下的 SS 自带了局域网分发网络的功能, 这里使用的是 <code>privoxy</code>, 版本 3.0.23. <code>config.txt</code> 更改如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf>listen-address 0.0.0.0:1234      # 改为自己想要的端口号, 因为服务器不是静态IP, IP 就设置成 0.0.0.0:1234 了, [::]:1234 应该也可以.
forward        / .               # 转发所有通信（/）到所有目标（.)
forward-socks5 / 127.0.0.1:1080  # 转发所有通信到 SS 代理服务器上.</code></pre></td></tr></table></div></div><p>三行搞定, 端口 <code>1234</code> 需要在防火墙中设置为允许.</p><p>完成这些步骤, 就可以把 IP 和端口告诉自己的好朋友和妹子们, 通过这个 HTTP 代理就能免费上网了!</p><h3 id=ios-macos-平台使用-surge>iOS / macOS 平台使用 Surge</h3><h4 id=全局使用代理>全局使用代理</h4><p>iOS 10 支持 IPv6 后, iOS 不需要依赖校内服务器就可以上网了. 需要搭配使用一个 &ldquo;网络调试&rdquo; 神器 Surge. 作者又发布了 Surge for Mac, 配置通用, 所以 iOS / macOS 平台下使用 Surge 的方法也通用.</p><p>其他高校的 v6 站直连, <code>*6.edu.cn</code> 填到 <code>skip-proxy</code> 中代理处理. 其他规则也很好写.</p><p><strong>配置规则</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf>[Rule]
IP-CIDR,202.113.0.0/16,DIRECT     # 校内 IP
DOMAIN-SUFFIX,twt.edu.cn,DIRECT   # 直接访问校内网站
DOMAIN-SUFFIX,tju.edu.cn,DIRECT   # 直接访问校内网站
FINAL,Proxy                       # 所有请求走代理服务器</code></pre></td></tr></table></div></div><p>macOS 命令行使用代理可以用 ProxyChains, 也可以用傻瓜模式的 Proxifier. 配置和 Windows 平台下的 Proxifier 一样.</p><p><strong>配置 Proxy Servers</strong></p><p><img src=/img/post/2016-08-26-tjunet/macOS_Proxifier_Proxy_Servers.png alt="Proxy Servers" title="Proxy Servers"></p><p><strong>配置 Proxification Rules</strong></p><p>校内的和 IPv6 连接直连, 其余都走代理.</p><p><img src=/img/post/2016-08-26-tjunet/macOS_Proxification_Rules.png alt="Proxification Rules" title="Proxification Rules"></p><h3 id=ios-macos-平台使用-surge-进阶>iOS / macOS 平台使用 Surge 进阶</h3><p>既然使用了 Surge, 一定好好折腾一下, 不然浪费了这么强大的工具.</p><p>配置的目标是可以自动切换上网方式, 只要打开 Surge, 任何网络环境都可以上网:</p><ul><li>校园网下自动使用 IPv6 免流量上网, 科学上网.</li><li>移动数据网络下使用 IPv4, PAC 自动切换, 国内直连, 科学上网.</li><li>一般 / 特定网络下(比如咖啡馆 WiFi)使用 IPv4, PAC 自动切换, 国内直连, 科学上网.</li></ul><p>这里以两台 SS 服务器为例.</p><p><strong>配置服务器</strong></p><p>添加两台服务器的 v4 和 v6 的访问方式:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf>[Proxy]
server1.ss.v4 = custom,v4_IP,10001,chacha20,pass1,http://surge.pm/ss.module
server1.ss.v6 = custom,v6_IP,10001,chacha20,pass1,http://surge.pm/ss.module
server2.ss.v4 = custom,v4_IP,10001,chacha20,pass1,http://surge.pm/ss.module
server2.ss.v6 = custom,v6_IP,10001,chacha20,pass1,http://surge.pm/ss.module</code></pre></td></tr></table></div></div><p><strong>配置规则</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf>[Rule]
DOMAIN-SUFFIX,t66y.com,Proxy         # 一直走代理的连接
DOMAIN-SUFFIX,ad.sina.com.cn,REJECT  # 拒绝的连接
GEOIP,CN,GEO CN                      # 国内连接
FINAL,Proxy                          # 其余所有连接</code></pre></td></tr></table></div></div><p>正常访问的外国网站也会走代理, 就当加速了&hellip;</p><p><strong>配置代理服务器组</strong></p><p>ss.url-test.v4 为 v4 环境下挑选一个最快服务器, ss.url-test.v6 为 v6 环境下挑选一个最快服务器.</p><p>Proxy 代理方式设置为根据 ssid 切换, 默认为 v4 环境, 移动数据网络下 cellular 当然也走 v4, 校园网 tjuwlan 要走 v6 服务器, 还可以设置其他一些特定的 ssid.</p><p>GEO CN 代理方式也根据 ssid 切换, 默认 v4 环境直连, v6 环境下走 v6 代理服务器.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-conf data-lang=conf>[Proxy Group]
ss.url-test.v4 = url-test, server1.ss.v4, server2.ss.v4, url = http://www.google.com/generate_204
ss.url-test.v6 = url-test, server1.ss.v6, server2.ss.v4, url = http://www.google.com/generate_204
Proxy = ssid, default = ss.url-test.v4, cellular = ss.url-test.v4, &#34;tjuwlan&#34; = ss.url-test.v6, &#34;实验室宽带 AP&#34; = ss.url-test.v4
GEO CN = ssid, default = DIRECT, cellular = DIRECT, &#34;tjuwlan&#34; = ss.url-test.v6, &#34;实验室宽带 AP&#34; = DIRECT</code></pre></td></tr></table></div></div><p>Surge 这点最好, iOS / macOS 平台配置完就可以应付各种网络环境.</p><p>iOS 支持 IPv6 后, 搭配 Surge 可以独立免费上网. 我的 Android 仍然只有本地链路地址, 暂时无解, 只能依靠一台校内服务器.</p><h1 id=目前的解决方案>目前的解决方案</h1><ul><li>实验室台式机: SS, 负责 PT 做种, 通过 Privoxy 分发网络.</li><li>macOS: Surge.</li><li>iOS: Surge.</li><li>Android: 通过 Privoxy 分发的网络.</li><li>Win 笔记本: VPN, 免折腾.</li></ul><p>哈哈, 至今从没买过学校的流量包!</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Mindy Cong</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2019-03-25
<a href=https://github.com/9ft/log/commit/c1be0713d341c437b4f319e1a15520359951d335 title="migrate post">(c1be071)</a></span></p></div><footer class=post-footer><nav class=post-nav><a class=prev href=/post/nginx-https/><i class="iconfont icon-left"></i><span class="prev-text nav-default">使用 Let’s Encrypt 为网站增加 HTTPS 访问方式</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/music-player/><span class="next-text nav-default">音乐播放器</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname==='localhost')return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='mindytech';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=http://mindy.tk/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017 -
2019
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Mindy Cong</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script type=text/javascript src=/dist/even.26188efa.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-46567212-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>